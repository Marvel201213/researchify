<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Buda:wght@300&family=Manrope:wght@200..800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="static/style.css" />
    <script>
      MathJax = {
        loader: {
          load: ["[tex]/color", "[tex]/cancel"]
        },
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"]
          ],
          processEscapes: true
        },
        options: {
          enableMenu: false,
          processHtmlClass: "tex2jax_process",
          ignoreHtmlClass: "tex2jax_ignore"
        },
        startup: {
          pageReady() {
            return MathJax.startup.defaultPageReady().then(function () {
              initArticleOpen(document);
            });
          }
        }
      };
    </script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"
    ></script>
    <title>Researchify</title>
  </head>
  <body>
    <nav class="sticky-nav">
      <h1 class="site-title">Researchify</h1>
      <ul class="topnav">
        <!-- <li>
          <a href="#Main" class="active">Random Article Generator</a>
        </li>
        <li><a href="#Saved">Personal Collection</a></li>
        <li class="last">
          <a href="#Login">LogIn</a>
        </li> -->
      </ul>
    </nav>
    <main class="content-wrapper">
      <div class="button-parent-container">
        <button id="generate-articles-button" class="button-primary">
          Generate new Articles (click Titles for ARXIV pages)
        </button>
      </div>
      <ul id="article-list">
        {% for category_articles in articles %} {% for article in
        category_articles %}
        <li class="article">
          <h2>
            <a
              href="{{article.get_link()}}"
              target="_blank"
              rel="noopener noreferrer"
              >{{article.get_title()}}</a
            >
          </h2>
          <div class="dropdown-container">
            <button class="dropdown-toggle">
              <span class="arrow">&#9660;</span>
            </button>
            <div class="dropdown-content">
              <p>{{article.get_abstract()}}</p>
            </div>
          </div>
        </li>
        {% endfor %} {% endfor %}
      </ul>
    </main>
    <footer></footer>
  </body>
  <script>
    const currentYear = new Date().getFullYear();
    const footer = document.querySelector("footer");
    footer.textContent = "Â© " + currentYear + " Akshath Sivachidhambaram";
    function initArticleOpen(containerElement) {
      const dropdownToggles = (containerElement || document).querySelectorAll(
        ".dropdown-toggle"
      );
      dropdownToggles.forEach((button) => {
        button.removeEventListener("click", toggleDropdown);
        button.addEventListener("click", toggleDropdown);
      });
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([containerElement || document]);
      }
    }
    function toggleDropdown() {
      const container = this.closest(".dropdown-container");
      container.classList.toggle("show-content");
    }
    document.addEventListener("DOMContentLoaded", function () {
      const generateButton = document.getElementById(
        "generate-articles-button"
      );
      const articleList = document.getElementById("article-list");
      function createArticleItem(article) {
        const li = document.createElement("li");
        li.className = "article";
        const title = article["title"];
        const link = article["link"];
        const abstract = article["abstract"];
        li.innerHTML = `
          <h2><a href="${link}" rel="noopener noreferrer" target="_blank">${title}</a></h2>
          <div class="dropdown-container">
            <button class="dropdown-toggle">
              <span class="arrow">&#9660;</span>
            </button>
            <div class="dropdown-content">
              <p>${abstract}</p>
            </div>
          </div>`;
        return li;
      }

      if (generateButton) {
        generateButton.addEventListener("click", function () {
          articleList.innerHTML =
            '<li class="article"><p>Loading new articles... (This may take a moment)</p></li>';
          generateButton.disabled = true;
          fetch("/get-articles")
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              articleList.innerHTML = "";
              const articles = data.articles || [];
              if (articles.length >= 1) {
                articles.forEach((category_articles) => {
                  category_articles.forEach((article) => {
                    articleList.appendChild(createArticleItem(article));
                  });
                });
              } else {
                articleList.innerHTML =
                  '<li class="article"><p>I guess something went wrong with article generation.</p></li>';
              }
            })
            .catch((error) => {
              console.error("Error fetching articles:", error);
              articleList.innerHTML =
                '<li class="article"><p style="color:red;">Error loading articles. Please check the console.</p></li>';
            })
            .finally(() => {
              generateButton.disabled = false;
              initArticleOpen(articleList);
            });
        });
      }
    });
  </script>
</html>
